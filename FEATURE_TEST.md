# 右键上传图片功能测试

## 新增功能说明

本次更新为 Obsidian uPic 插件添加了两个新的图片上传功能：

### 1. 文件右键上传功能
- **功能描述**: 在文件浏览器中右键点击图片文件，可以直接上传到 uPic
- **支持格式**: 与现有功能保持一致，支持 jpg, jpeg, png, gif, bmp, webp 等格式
- **使用方法**: 
  1. 在 Obsidian 文件浏览器中找到图片文件
  2. 右键点击图片文件
  3. 选择 "Upload to uPic" 菜单项
  4. 等待上传完成，如果当前文档中有该图片的引用，会自动替换为在线链接

### 2. 选择本地图片上传命令
- **功能描述**: 通过命令面板选择本地图片文件进行上传
- **使用方法**:
  1. 按 `Cmd/Ctrl + P` 打开命令面板
  2. 搜索 "Select and upload local image" 或 "选择本地图片上传"
  3. 选择要上传的图片文件
  4. 图片上传成功后会自动插入到当前编辑器位置

## 技术实现要点

### 文件右键菜单集成
- 使用 `workspace.on('file-menu')` 事件监听文件右键菜单
- 通过 `isImageFile()` 方法检查文件类型，只为图片文件显示上传选项
- 集成现有的上传逻辑和错误处理机制

### 文件选择器功能
- 创建 HTML `input[type="file"]` 元素实现文件选择
- 支持文件类型和大小验证
- 与现有的临时文件处理逻辑保持一致

### 错误处理和用户反馈
- 保持与现有功能一致的错误处理机制
- 提供清晰的上传进度和结果反馈
- 支持桌面端检查，移动端显示相应提示

## 测试清单

### 文件右键上传测试
- [ ] 在文件浏览器中右键点击 jpg 图片文件，确认显示 "Upload to uPic" 选项
- [ ] 在文件浏览器中右键点击 png 图片文件，确认显示 "Upload to uPic" 选项
- [ ] 在文件浏览器中右键点击非图片文件，确认不显示上传选项
- [ ] 点击 "Upload to uPic" 选项，确认上传功能正常工作
- [ ] 上传成功后，确认显示成功通知
- [ ] 如果当前文档中有该图片引用，确认自动替换为在线链接

### 选择本地图片上传测试
- [ ] 通过命令面板找到 "Select and upload local image" 命令
- [ ] 执行命令后确认打开文件选择对话框
- [ ] 选择支持的图片格式，确认上传成功
- [ ] 选择不支持的文件格式，确认显示错误提示
- [ ] 选择过大的文件，确认显示大小限制提示
- [ ] 上传成功后，确认图片链接正确插入到编辑器中

### 兼容性测试
- [ ] 确认新功能不影响现有的拖拽上传功能
- [ ] 确认新功能不影响现有的粘贴上传功能
- [ ] 确认错误处理和用户反馈与现有功能保持一致

## 注意事项

1. **桌面端限制**: 新功能仅在桌面端可用，移动端会显示相应提示
2. **文件格式支持**: 支持的图片格式与插件设置中的 `supportedFormats` 配置保持一致
3. **文件大小限制**: 遵循插件的最大文件大小限制
4. **uPic 依赖**: 功能正常工作需要 uPic 应用正确安装和配置

## 更新内容总结

- ✅ 添加文件右键菜单监听器
- ✅ 实现图片文件右键上传功能
- ✅ 添加选择本地图片上传命令
- ✅ 实现文件选择器上传逻辑
- ✅ 集成现有的错误处理和用户反馈机制
- ✅ 修复 TypeScript 编译错误
- ✅ 保持与现有功能的一致性

所有功能已实现并通过编译测试，可以开始实际使用测试。